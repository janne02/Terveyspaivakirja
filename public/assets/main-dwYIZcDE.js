import"./style-KbtrlSa8.js";let E=localStorage.getItem("name");document.getElementById("name").innerHTML=E;document.addEventListener("DOMContentLoaded",function(){document.getElementById("logout").addEventListener("click",function(t){t.preventDefault(),f()})});async function f(){localStorage.clear(),window.alert("Logout succesfully"),window.location.href="home.html"}const w=document.querySelector(".get_users");w.addEventListener("click",y);async function y(){console.log("Button clicked!");try{const e=localStorage.getItem("token"),o=await(await fetch("https://hyte-janne.northeurope.cloudapp.azure.com/api/users",{headers:{Authorization:"Bearer: "+e}})).json();console.log(o);const a=document.querySelector(".tbody");a.innerHTML="",o.forEach(n=>{console.log(n.username);let r=document.createElement("tr"),i=document.createElement("td");i.innerText=n.username;let l=document.createElement("td");l.innerText=n.user_level;let d=document.createElement("td"),c=document.createElement("button");c.className="check",c.setAttribute("data-id","1"),c.innerText="Info",c.addEventListener("click",()=>k(n.user_id)),d.appendChild(c);let u=document.createElement("td"),s=document.createElement("button");s.className="del",s.setAttribute("data-id","1"),s.innerText="Delete",s.innerText="Delete",s.addEventListener("click",()=>B(n.user_id)),u.appendChild(s);let m=document.createElement("td");m.innerText=n.user_id,r.appendChild(i),r.appendChild(l),r.appendChild(d),r.appendChild(u),r.appendChild(m),a.appendChild(r)})}catch(e){console.log(e)}}async function k(e){try{const t=localStorage.getItem("token"),a=await(await fetch(`https://hyte-janne.northeurope.cloudapp.azure.com/api/users/${e}`,{method:"GET",headers:{Authorization:"Bearer: "+t}})).json();console.log(a),I(a)}catch(t){console.error("Error fetching user data:",t)}}function I(e){const t=document.querySelector(".info_dialog"),o=t.querySelectorAll("span");o[0].innerText=e.user_id,o[1].innerText=e.username,o[2].innerText=e.email,o[3].innerText=e.user_level,t.showModal(),t.querySelector("button[autofocus]").addEventListener("click",()=>{t.close()})}async function B(e){try{const t=localStorage.getItem("token");if(!confirm(`Are you sure you want to delete the user with ID: ${e}?`))return;if(!(await fetch(`https://hyte-janne.northeurope.cloudapp.azure.com/api/users/${e}`,{method:"DELETE",headers:{Authorization:"Bearer: "+t}})).ok)throw alert("Error: User has diaryentries, delete them first"),new Error("Failed to delete user");console.log("User deleted successfully");const n=JSON.parse(localStorage.getItem("user"));n&&n.id===e?await logout():await y()}catch(t){console.error("Error deleting user:",t)}}async function v(e){try{const t=localStorage.getItem("token");if(!confirm(`Are you sure you want to delete entry with ID: ${e}?`))return;if(!(await fetch(`https://hyte-janne.northeurope.cloudapp.azure.com/api/entries/${e}`,{method:"DELETE",headers:{Authorization:"Bearer: "+t}})).ok)throw new Error("Failed to delete entry");console.log("Entry deleted successfully")}catch(t){console.error("Error deleting entry:",t)}}const S=document.getElementById("putUserButton");S.addEventListener("click",async()=>{const e=localStorage.getItem("token"),t=document.getElementById("username").value,o=document.getElementById("password").value,a=document.getElementById("email").value,n={username:t,password:o,email:a};try{if(!(await fetch("https://hyte-janne.northeurope.cloudapp.azure.com/api/users/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify(n)})).ok)throw new Error("Failed to update user");window.alert("User updated successfully"),document.getElementById("username").value="",document.getElementById("password").value="",document.getElementById("email").value=""}catch{window.alert("Error updating user: Input information is not valid or doesnt meet requirements.")}});const T=document.querySelector(".get_entry");T.addEventListener("click",C);async function C(){console.log("Button clicked!");try{const e=localStorage.getItem("token"),o=await(await fetch("https://hyte-janne.northeurope.cloudapp.azure.com/api/entries/",{headers:{Authorization:"Bearer "+e}})).json();if(console.log(o),o.length==0){alert("No diaryentries found!!");return}const a=document.querySelector(".tbody1");a.innerHTML="",o.forEach(n=>{let r=document.createElement("tr"),i=document.createElement("td");i.innerText=n.entry_id;let l=document.createElement("td");l.innerText=n.entry_date;let d=document.createElement("td");d.innerText=n.mood;let c=document.createElement("td");c.innerText=parseFloat(n.weight).toFixed(2);let u=document.createElement("td");u.innerText=parseInt(n.sleep_hours);let s=document.createElement("td");s.innerText=n.notes;let m=document.createElement("td");m.innerText=n.created_at;let h=document.createElement("td"),p=document.createElement("button");p.className="del",p.setAttribute("data-id","1"),p.innerText="Delete",p.addEventListener("click",()=>v(n.entry_id)),h.appendChild(p),r.appendChild(i),r.appendChild(l),r.appendChild(d),r.appendChild(c),r.appendChild(u),r.appendChild(s),r.appendChild(m),r.appendChild(h),a.appendChild(r)})}catch(e){console.log(e)}}const g=document.getElementById("addEntry");document.querySelector(".addform1");g.addEventListener("click",async e=>{e.preventDefault(),console.log(g);const t=document.getElementById("entry_date").value,o=L(t),a=document.getElementById("mood").value,n=parseFloat(document.getElementById("weight").value),r=parseInt(document.getElementById("sleep_hours").value),i=document.getElementById("notes").value,l={entry_date:o,mood:a,weight:n,sleep_hours:r,notes:i};console.log(l);try{const d=localStorage.getItem("token");if(!(await fetch("https://hyte-janne.northeurope.cloudapp.azure.com/api/entries",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+d},body:JSON.stringify(l)})).ok)throw new Error("Failed to add entry");alert("Entry added successfully"),document.getElementById("entry_date").value="",document.getElementById("mood").value="",document.getElementById("weight").value="",document.getElementById("sleep_hours").value="",document.getElementById("notes").value=""}catch(d){console.error("Error adding entry:",d),alert("Error adding entry: "+d.message)}});function L(e){const t=new Date(e),o=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return`${o}-${a}-${n}`}document.addEventListener("DOMContentLoaded",function(){document.getElementById("darkModeToggle").addEventListener("click",function(){document.body.classList.toggle("dark-mode");const o=document.body.classList.contains("dark-mode");localStorage.setItem("darkMode",o)}),JSON.parse(localStorage.getItem("darkMode"))&&document.body.classList.add("dark-mode")});
